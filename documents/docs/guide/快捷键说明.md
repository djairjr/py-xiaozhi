# Shortcut key description

## Overview

py-xiaozhi provides complete global shortcut key support, allowing quick operations even when running in the background. The shortcut key system is implemented based on the pynput library and supports cross-platform use.

##Default shortcut keys

| Function classification | Shortcut keys | Function description | Usage scenarios |
|---------|-------|---------|----------|
| **Voice Interaction** | `Ctrl+J` | Press and hold to speak mode | Press and hold to record, release to send |
| | `Ctrl+K` | Automatic conversation mode | Turn on/off automatic voice detection |
| | `Ctrl+Q` | Interrupt conversation | Stop AI reply immediately |
| **Mode Control** | `Ctrl+M` | Switch interactive mode | Switch between manual/automatic mode |
| | `Ctrl+W` | Show/hide window | Minimize/restore window |

## Detailed description of shortcut keys

### Voice interaction shortcut keys

#### Ctrl+J - Press and hold to speak
- **Function**: Manual pressing mode, recording while pressing
- **How ​​to use**:
1. Press and hold `Ctrl+J`
2. Talk into the microphone
3. Release the button to automatically send voice
- **Applicable Scenarios**: Accurately control recording time to avoid environmental noise interference

#### Ctrl+K - Automatic dialogue
- **Function**: Turn on/off automatic conversation mode
- **How ​​to use**: Press `Ctrl+K` to switch the automatic dialogue state
- **Applicable Scenarios**: Continuous conversations, long-term interactions

#### Ctrl+Q - Interrupt conversation
- **Function**: Immediately stop the current AI voice reply
- **How ​​to use**: Press `Ctrl+Q` during the AI ​​reply process
- **Applicable Scenario**: When it is necessary to urgently interrupt the AI ​​response

### Mode control shortcut keys

#### Ctrl+M - Switch interactive mode
- **Function**: Switch between different voice interaction modes
- **How ​​to use**: Press `Ctrl+M` to cycle through modes
- **Mode type**: Manual pressing mode ↔ Automatic conversation mode

#### Ctrl+W - Show/hide window
- **Function**: Control the display status of the main window
- **How ​​to use**: Press `Ctrl+W` to switch window visibility
- **Applicable Scenarios**: Quickly hide/show the main interface

## Shortcut key configuration

### Configuration file location

Shortcut key configurations are stored in the `config/config.json` file:

```json
{
  "SHORTCUTS": {
    "ENABLED": true,
    "MANUAL_PRESS": {
      "modifier": "ctrl",
      "key": "j",
"description": "Hold to speak"
    },
    "AUTO_TOGGLE": {
      "modifier": "ctrl",
      "key": "k",
"description": "Automatic conversation"
    },
    "ABORT": {
      "modifier": "ctrl",
      "key": "q",
"description": "Interrupt conversation"
    },
    "MODE_TOGGLE": {
      "modifier": "ctrl",
      "key": "m",
"description": "Switch mode"
    },
    "WINDOW_TOGGLE": {
      "modifier": "ctrl",
      "key": "w",
"description": "Show/hide window"
    }
  }
}
```

### Custom shortcut keys

#### Supported modifier keys

- `ctrl` - Ctrl key
- `alt` - Alt key
- `shift` - Shift key
- `ctrl+alt` - Ctrl+Alt combination
- `ctrl+shift` - Ctrl+Shift combination

#### Supported primary keys

- **Letter keys**: a-z
- **Number keys**: 0-9
- **Function keys**: f1-f12
- **Special keys**: space, enter, tab, esc

#### Configuration example

```json
{
  "SHORTCUTS": {
    "ENABLED": true,
    "MANUAL_PRESS": {
      "modifier": "alt",
      "key": "space",
"description": "Hold to speak"
    },
    "AUTO_TOGGLE": {
      "modifier": "ctrl+shift",
      "key": "a",
"description": "Automatic conversation"
    }
  }
}
```

## Platform compatibility

### Windows
- **Full Support**: All shortcut keys function normally
- **Permission Requirements**: Administrator permissions may be required in some cases
- **Note**: Avoid conflicts with system shortcut keys

### macOS
- **Permission Configuration**: Accessibility permissions need to be granted
- **Configuration Path**: System Preferences → Security & Privacy → Privacy → Accessibility
- **Terminal Permission**: If running through the terminal, you need to authorize the terminal

### Linux
- **User Group**: Users need to be added to the input group
- **Configuration command**: `sudo usermod -a -G input $USER`
- **Desktop Environment**: Supports X11 and Wayland

## troubleshooting

### Shortcut keys not responding

#### Check configuration
1. Confirm that `SHORTCUTS.ENABLED` in the configuration file is `true`
2. Check whether the shortcut key configuration format is correct
3. Verify the validity of modifier keys and primary keys

#### Permission issue
```bash
# macOS: Check accessibility permissions
System Preferences → Security & Privacy → Privacy → Accessibility

# Linux: Add user to audio group
sudo usermod -a -G input $USER

# Windows: Run with administrator rights
Right click on the application → Run as administrator
```

#### Conflict detection
1. Check if there are other programs occupying the same shortcut keys
2. Try changing to an uncommon shortcut key combination
3. Close potentially conflicting applications

### Common error handling

#### ImportError: No module named 'pynput'
```bash
#Install pynput library
pip install pynput
```

#### macOS Permission denied
```bash
# Check and reauthorize
System Preferences → Security & Privacy → Privacy → Accessibility
# Remove and re-add the application
```

#### Linux keyboard monitoring failed
```bash
# Log in again to take effect user group changes
sudo usermod -a -G input $USER
# Log out and log in again
```

## Advanced configuration

### Error recovery mechanism

System built-in shortcut key error recovery function:

- **HEALTH CHECK**: Check listener status every 30 seconds
- **Auto Restart**: Automatically restart when failure is detected
- **Error Count**: Trigger recovery when continuous errors exceed the limit
- **Status Cleanup**: Clean up button status when restarting

### Debug mode

Enable verbose log output:

```python
# Enable debug logging in configuration
import logging
logging.getLogger('pynput').setLevel(logging.DEBUG)
```

### Performance optimization

- **Key Caching**: Reduce duplicate key detection
- **Asynchronous processing**: non-blocking key event processing
- **Resource Management**: Automatically clean up listener resources

## Code reference

Shortcut key system implementation location:

- **Main implementation**: `src/views/components/shortcut_manager.py`
- **Configuration Management**: `src/utils/config_manager.py`
- **Application integration**: `src/application.py`

### Core method

```python
# Start shortcut key monitoring
from src.views.components.shortcut_manager import start_global_shortcuts_async
shortcut_manager = await start_global_shortcuts_async()

# Manually stop listening
await shortcut_manager.stop()
```